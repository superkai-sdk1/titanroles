<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>Мобильная комната</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Manrope:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
<div class="m3e-mobile-panel">
    <header class="m3e-header">
        <div class="stream-title">Мобильная комната</div>
        <div class="titan-signature">© 2025 by TITAN KBR. Powered and secured by TITAN DEV</div>
    </header>
    <div id="mobile-room-content">
        <!-- Динамически наполняется JS -->
    </div>
</div>
<script>
function renderRoomUI(roomId) {
    $('#mobile-room-content').html(
      `<div class="m3e-room-block" style="text-align:center;margin-top:48px;">
        <div style="font-size:1.5em;margin-bottom:20px;">Вы подключены к комнате</div>
        <div style="font-size:2.7em;font-weight:700;margin-bottom:30px;">${roomId}</div>
      </div>`
    );
}

function renderJoinForm() {
    $('#mobile-room-content').html(
      `<div class="m3e-room-block" style="max-width:350px;margin:48px auto 0 auto;text-align:center;">
        <div style="font-size:1.3em;margin-bottom:18px;">Введите номер комнаты:</div>
        <form id="room-id-form">
            <input id="room-id-input" type="text" maxlength="4" pattern="\\d{4}" class="m3e-input" style="font-size:1.3em;text-align:center;width:120px;" placeholder="0000" required>
            <button type="submit" class="m3e-btn m3e-btn-main" style="margin-left:12px;">Войти</button>
        </form>
      </div>`
    );
    $('#room-id-form').on('submit', function(e){
        e.preventDefault();
        const id = $('#room-id-input').val().trim();
        if(/^\d{4}$/.test(id)){
            location.hash = '#' + id;
            localStorage.setItem('mobileRoomId', id);
            renderRoomUI(id);
        } else {
            alert('Введите корректный номер комнаты (4 цифры)');
        }
    });
}

$(function(){
    let roomId = location.hash.replace(/^#/, '');
    if(!roomId){
        // Пробуем взять из localStorage (например, после обновления)
        roomId = localStorage.getItem('mobileRoomId') || '';
    }
    if(/^\d{4}$/.test(roomId)){
        renderRoomUI(roomId);
        // Сохраняем в localStorage для последующих обновлений страницы
        localStorage.setItem('mobileRoomId', roomId);
    } else {
        renderJoinForm();
    }
});
</script>
</body>
</html>
