<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>Панель</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Manrope:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://unpkg.com/qrious/dist/qrious.min.js"></script>
    <script src="ws-sync.js"></script>
    <script src="script.js"></script>
</head>
<body>
<header class="m3e-header">
    <div class="stream-title">Панель управления стримом</div>
    <div id="qr-block" style="text-align:center; margin:18px;">
        <p>Откройте панель на телефоне:</p>
        <canvas id="qr-canvas"></canvas>
        <div id="qr-url" style="font-size:0.9em;word-break:break-all;"></div>
    </div>
    <div class="file-block">
        <label for="fileToLoad" id="file-label" class="m3e-btn m3e-btn-main">Загрузить файл</label>
        <input type="file" name="file" id="fileToLoad" accept=".txt">
        <button id="manual-entry-btn" type="button" class="m3e-btn m3e-btn-secondary">Ручной ввод</button>
    </div>
    <div class="titan-signature">© 2025 by TITAN KBR. Powered and secured by TITAN DEV</div>
</header>

<!-- Панель ручного ввода -->
<div id="manual-entry-panel" class="m3e-manual-panel" style="display:none;">
    <h2 class="m3e-manual-title">Выберите никнеймы игроков</h2>
    <form id="manual-entry-form" class="m3e-manual-form">
        <div id="manual-players-list" class="m3e-manual-list"></div>
        <button type="submit" id="manual-save-btn" class="m3e-btn m3e-btn-main" style="margin-top:24px;">Сохранить рассадку</button>
    </form>
    <div class="titan-signature">© 2025 by TITAN KBR. Powered and secured by TITAN DEV</div>
</div>

<div class="main sidebar-panel show-roles-mode">
    <h1 class="dashboard-title">Панель управления</h1>
    <div class="player-list-panel" id="player-rows">
        <!-- Игроки добавляются скриптом -->
    </div>
    <div class="panel-controls">
        <button id="show-players-btn" class="m3e-btn m3e-btn-main" onclick="confirmRolesAndShowStatuses()">Сохранить рассадку</button>
        <button id="edit-roles-btn" class="m3e-btn m3e-btn-secondary" onclick="editRoles()">Редактировать роли</button>
        <button id="clear-role-btn" class="m3e-btn m3e-btn-secondary" onclick="clearRole()">Очистить роли</button>
        <button id="clear-status-btn" class="m3e-btn m3e-btn-secondary" onclick="clearStatus()">Очистить статусы</button>
        <input type="text" id="main-info-input" class="m3e-input" placeholder="Основная информация">
        <input type="text" id="game-number-input" class="m3e-input" placeholder="Дополнительная информация">
        <button class="reset-panel m3e-btn m3e-btn-danger" type="button" id="reset-panel-btn">Сбросить панель</button>
        <div class="overlay-toggles">
            <div class="toggle-row">
                <label class="m3e-switch">
                    <input type="checkbox" id="toggle-hide-players">
                    <span class="slider"></span>
                </label>
                <span>Скрыть игроков</span>
            </div>
            <div class="toggle-row">
                <label class="m3e-switch">
                    <input type="checkbox" id="toggle-main-info" checked>
                    <span class="slider"></span>
                </label>
                <span>Основная информация</span>
            </div>
            <div class="toggle-row">
                <label class="m3e-switch">
                    <input type="checkbox" id="toggle-additional-info" checked>
                    <span class="slider"></span>
                </label>
                <span>Дополнительная информация</span>
            </div>
            <div class="toggle-row">
                <label class="m3e-switch">
                    <input type="checkbox" id="toggle-status-panel" checked>
                    <span class="slider"></span>
                </label>
                <span>Порядок ухода</span>
            </div>
            <div class="toggle-row">
                <label class="m3e-switch">
                    <input type="checkbox" id="toggle-blur">
                    <span class="slider"></span>
                </label>
                <span>Блюр</span>
            </div>
        </div>
        <div class="titan-signature titan-signature-inpanel">© 2025 by TITAN KBR. Powered and secured by TITAN DEV</div>
    </div>
</div>
<div id="best-move-modal" class="modal">
    <div class="modal-content">
        <span class="close">×</span>
        <p>Выберите три цифры для Лучшего хода (ЛХ):</p>
        <div class="number-buttons-container">
            <div class="number-button" onclick="selectNumber(1)">1</div>
            <div class="number-button" onclick="selectNumber(2)">2</div>
            <div class="number-button" onclick="selectNumber(3)">3</div>
            <div class="number-button" onclick="selectNumber(4)">4</div>
            <div class="number-button" onclick="selectNumber(5)">5</div>
            <div class="number-button" onclick="selectNumber(6)">6</div>
            <div class="number-button" onclick="selectNumber(7)">7</div>
            <div class="number-button" onclick="selectNumber(8)">8</div>
            <div class="number-button" onclick="selectNumber(9)">9</div>
            <div class="number-button" onclick="selectNumber(10)">10</div>
        </div>
        <button id="save-best-move" class="m3e-btn m3e-btn-main">Сохранить</button>
    </div>
</div>
<script>
$(function(){
    const panelUrl = window.location.href.split('#')[0];
    const qr = new QRious({
        element: document.getElementById('qr-canvas'),
        value: panelUrl,
        size: 160
    });
    document.getElementById('qr-url').textContent = panelUrl;
    $('#qr-block').show();
});
</script>
</body>
</html>
